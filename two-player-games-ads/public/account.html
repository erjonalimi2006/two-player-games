<!doctype html>
<html>
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Account</title>
<link rel="stylesheet" href="/assets/styles.css">
</head>
<body>
  <header class="site-header"><h1>Account</h1><nav><a href="/">Home</a></nav></header>
  <main class="container">
    <section class="game-card">
      <h3>Register</h3>
      <input id="regEmail" placeholder="Email" style="width:100%;padding:8px;margin-top:8px">
      <input id="regPass" type="password" placeholder="Password" style="width:100%;padding:8px;margin-top:8px">
      <button onclick="register()" class="btn">Register</button>
    </section>

    <section class="game-card" style="margin-top:12px">
      <h3>Login</h3>
      <input id="logEmail" placeholder="Email" style="width:100%;padding:8px;margin-top:8px">
      <input id="logPass" type="password" placeholder="Password" style="width:100%;padding:8px;margin-top:8px">
      <button onclick="login()" class="btn">Login</button>
      <p id="status" style="margin-top:8px;color:green"></p>
    </section>

    <section style="margin-top:12px">
      <button onclick="logout()" class="btn">Logout</button>
      <p id="who"></p>
    </section>
  </main>

<script>
function register(){
  const email=document.getElementById('regEmail').value;
  const password=document.getElementById('regPass').value;
  fetch('/api/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})})
  .then(r=>r.json()).then(j=>{ if(j.token){ localStorage.setItem('token',j.token); localStorage.setItem('email',email); document.getElementById('status').textContent='Registered'; showUser() } else alert(j.error||JSON.stringify(j)) })
}
function login(){
  const email=document.getElementById('logEmail').value;
  const password=document.getElementById('logPass').value;
  fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})})
  .then(r=>r.json()).then(j=>{ if(j.token){ localStorage.setItem('token',j.token); localStorage.setItem('email',email); document.getElementById('status').textContent='Logged in'; showUser() } else alert(j.error||JSON.stringify(j)) })
}
function logout(){ localStorage.removeItem('token'); localStorage.removeItem('email'); showUser(); document.getElementById('status').textContent='Logged out' }
function showUser(){ document.getElementById('who').textContent = localStorage.getItem('email') ? 'Logged in as '+localStorage.getItem('email') : 'Not logged in' }
showUser();
</script>
</body>
</html>
