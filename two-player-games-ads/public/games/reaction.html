<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Reaction Duel</title><link rel="stylesheet" href="/assets/styles.css"></head><body>
<main class="container"><h2>Reaction Duel</h2><p>Wait for GO. First click wins.</p><div id="msg">Ready</div><button onclick="start()" class="btn" style="margin-top:8px">Start</button><div style="margin-top:8px"><button onclick="hit()" id="hitbtn">Hit</button></div><p id="res"></p><div style="margin-top:12px"><a class="btn" href="/">Back</a></div></main>
<script>
let active=false, startTime=0;
function start(){
  document.getElementById('msg').textContent='Wait...'; document.getElementById('res').textContent=''; active=false;
  const delay = 1000 + Math.random()*3000;
  setTimeout(()=>{ document.getElementById('msg').textContent='GO!'; active=true; startTime=Date.now(); }, delay);
}
function hit(){
  if(!active){ document.getElementById('res').textContent='Too early'; return }
  const t = Date.now()-startTime;
  document.getElementById('res').textContent='Reaction: '+t+' ms';
  saveScorePayload('reaction', Math.max(0, 3000 - t)); // higher better
  active=false;
}

function saveScorePayload(game, numeric){
  const token = localStorage.getItem('token');
  const scoreVal = numeric!==undefined?numeric:1;
  if(!token){ alert('Log in to save scores'); return; }
  fetch('/api/score', {
    method:'POST',
    headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},
    body:JSON.stringify({game:game, score:String(scoreVal), numeric_score: Number(scoreVal)})
  }).then(r=>r.json()).then(j=>alert(j.message||JSON.stringify(j)));
}
</script></body></html>